from bs4 import BeautifulSoup
import urllib
import re
import json
from textblob import TextBlob
import langid

# words that can charaterize json ClaimReview which I'd like to find
MAIN_KEYWORD = ["Generated by Full Fact Claim Review Schema"]
CLAIM_JSON_KEYWORD = [ "claimReviewed", "itemReviewed", "reviewRating" ]
JSON_KEYWORD = ["script type=\"application/ld+json\""]
LANG_KEYWORD = ["html lang"]
#JSON_KEYWORD = ["ciaoo"]


# extrace language of page
def extract_language(line):
  
  # model's line: <html lang="it-IT">

  text1 = line.split("lang=")   
  text2 = text1[1].split(">")

  return text2[0]


# take all possible claimReviewed scheme
def get_claimReviewed_scheme_in_html_code(file_name):

  html_code = open(file_name,'r',errors="ignore")

  debug = False # FOR HELP IN DEBUG

  # loop on each line of the code, to find a possible claimReviewed scheme
  my_json = []
  language = ''
  for line in html_code:

    # check if CLAIM_JSON_KEYWORD
    for claim_json_keyword in CLAIM_JSON_KEYWORD:
      if line.find(claim_json_keyword) != -1:

        if debug == True: print("found with CLAIM_JSON_KEYWORD")

        my_json.append(line)

        continue  # to avoid some iterations

    # check if JSON_KEYWORD
    for script_keyword in JSON_KEYWORD:
      if line.find(script_keyword) != -1:

        if debug == True: print("found with JSON_KEYWORD")

        my_json.append(line)

        continue  # to avoid some iterations

     # check if JSON_KEYWORD
    for main_keyword in MAIN_KEYWORD:
      if line.find(main_keyword) != -1:

        if debug == True: print("found with MAIN_KEYWORD")
        my_json.append(line)

        continue  # to avoid some iterations

    # language of the page
    if line.find(LANG_KEYWORD[0]) != -1:
        language = extract_language(line)
        continue
    

  # formatting json

  return (my_json, language)


def main(): 
  result1 = get_claimReviewed_scheme_in_html_code("gasdotto.html")
  result2 = get_claimReviewed_scheme_in_html_code("confine_russia_finlandia.html")

  result = []
  result.append(result1)
  result.append(result2)

  # tuple: < json, language >
  for r in result:
    if r[0] == []:
      print("--- no json found ---")

    else:
      print("----- result -----")
      print("my_json:")
      print(r[0])
      print("language: " + r[1])

main()